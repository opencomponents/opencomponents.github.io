"use strict";(self.webpackChunkoc_website=self.webpackChunkoc_website||[]).push([[9217],{5518:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>o,contentTitle:()=>c,default:()=>h,frontMatter:()=>d,metadata:()=>s,toc:()=>a});const s=JSON.parse('{"id":"components/the-server.js","title":"Server-side Logic (server.js / entry.server.ts)","description":"This guide covers how to add server-side logic to your components. Modern components use src/entry.server.ts with the Server API, while the legacy server.js with callbacks is still supported for backwards compatibility.","source":"@site/docs/components/the-server.js.md","sourceDirName":"components","slug":"/components/the-server.js","permalink":"/docs/components/the-server.js","draft":false,"unlisted":false,"editUrl":"https://github.com/opencomponents/opencomponents.github.io/tree/master/website/docs/components/the-server.js.md","tags":[],"version":"current","sidebarPosition":4,"frontMatter":{"sidebar_position":4},"sidebar":"tutorialSidebar","previous":{"title":"Structure of package.json","permalink":"/docs/components/package.json-structure"},"next":{"title":"Template System","permalink":"/docs/building/template-system"}}');var t=r(4848),i=r(8453);const d={sidebar_position:4},c="Server-side Logic (server.js / entry.server.ts)",o={},a=[{value:"When do you need a server entry?",id:"when-do-you-need-a-server-entry",level:2},{value:"Static components (no server entry needed)",id:"static-components-no-server-entry-needed",level:3},{value:"Dynamic components (server entry required)",id:"dynamic-components-server-entry-required",level:3},{value:"Basic Example",id:"basic-example",level:2},{value:"Real-World Example: User Dashboard",id:"real-world-example-user-dashboard",level:2},{value:"Advanced Features",id:"advanced-features",level:2},{value:"Error handling",id:"error-handling",level:3},{value:"Using context",id:"using-context",level:3},{value:"Context properties",id:"context-properties",level:2},{value:"renderComponent API",id:"rendercomponent-api",level:3},{value:"renderComponents API",id:"rendercomponents-api",level:3},{value:"Add static resource to the component",id:"add-static-resource-to-the-component",level:2},{value:"Prepare package file",id:"prepare-package-file",level:3},{value:"Add image in the view template",id:"add-image-in-the-view-template",level:3},{value:"Update server file",id:"update-server-file",level:3},{value:"Performance Tips",id:"performance-tips",level:2},{value:"Node.js dependencies",id:"nodejs-dependencies",level:2},{value:"Local development",id:"local-development",level:3},{value:"Publishing considerations",id:"publishing-considerations",level:3},{value:"Common Issues",id:"common-issues",level:2},{value:"Missing return statement",id:"missing-return-statement",level:3},{value:"Undefined property access",id:"undefined-property-access",level:3},{value:"Debugging tips",id:"debugging-tips",level:3},{value:"Type inference (optional)",id:"type-inference-optional",level:3},{value:"Legacy (deprecated): server.js with callbacks",id:"legacy-deprecated-serverjs-with-callbacks",level:2},{value:"Next Steps",id:"next-steps",level:2}];function l(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,i.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"server-side-logic-serverjs--entryserverts",children:"Server-side Logic (server.js / entry.server.ts)"})}),"\n",(0,t.jsxs)(n.p,{children:["This guide covers how to add server-side logic to your components. Modern components use ",(0,t.jsx)(n.code,{children:"src/entry.server.ts"})," with the ",(0,t.jsx)(n.code,{children:"Server"})," API, while the legacy ",(0,t.jsx)(n.code,{children:"server.js"})," with callbacks is still supported for backwards compatibility."]}),"\n",(0,t.jsx)(n.admonition,{title:"Modern API Recommended",type:"tip",children:(0,t.jsxs)(n.p,{children:["New components should use the modern ",(0,t.jsx)(n.code,{children:"Server"})," API shown in this guide. The legacy callback style (",(0,t.jsx)(n.code,{children:"module.exports.data = (context, callback) => { ... }"}),") still works but is considered deprecated."]})}),"\n",(0,t.jsx)(n.h2,{id:"when-do-you-need-a-server-entry",children:"When do you need a server entry?"}),"\n",(0,t.jsxs)(n.p,{children:["Understanding when to use ",(0,t.jsx)(n.code,{children:"server.js"})," is crucial for building effective OpenComponents. Here's a simple decision guide:"]}),"\n",(0,t.jsx)(n.h3,{id:"static-components-no-server-entry-needed",children:"Static components (no server entry needed)"}),"\n",(0,t.jsx)(n.p,{children:"Use static components when your content doesn't change based on user input or external data:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-tsx",children:'// src/entry.client.tsx - Static component\nexport default function Component() {\n  return <div className="banner">Welcome to our site!</div>;\n}\n'})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Use cases:"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Static banners or promotional content"}),"\n",(0,t.jsx)(n.li,{children:"Fixed navigation menus"}),"\n",(0,t.jsx)(n.li,{children:"Copyright footers"}),"\n",(0,t.jsx)(n.li,{children:"Terms of service links"}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"dynamic-components-server-entry-required",children:"Dynamic components (server entry required)"}),"\n",(0,t.jsx)(n.p,{children:"Use a server entry when you need to:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.strong,{children:"Fetch data from APIs or databases"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.strong,{children:"Process user parameters"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.strong,{children:"Implement business logic"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.strong,{children:"Handle authentication or personalization"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.strong,{children:"Format or transform data"})}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-tsx",children:"// src/entry.client.tsx - Dynamic component\nexport default function Component(props: {\n  name: string;\n  messageCount: number;\n}) {\n  return (\n    <div>\n      Hello {props.name}, you have {props.messageCount} messages\n    </div>\n  );\n}\n"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:'// src/entry.server.ts - Provides dynamic data (modern API)\nimport { Server } from "oc-server";\n\nexport const server = new Server({ development: { console: true } })\n  .withParameters({\n    userId: {\n      type: "number",\n      description: "User id",\n      example: 1,\n      default: 1,\n      mandatory: true,\n    },\n  })\n  .handler(async (params, ctx) => {\n    const { userId } = params;\n    // Fetch user data and message count\n    ctx.setHeader("Cache-Control", "max-age=300");\n    return { name: "John", messageCount: 5 };\n  })\n  .action("markAsRead", async (params: { messageId: string }) => {\n    return { ok: true };\n  });\n'})}),"\n",(0,t.jsx)(n.h2,{id:"basic-example",children:"Basic Example"}),"\n",(0,t.jsx)(n.p,{children:"Here's a simple dynamic component that demonstrates the core pattern:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:'// src/entry.server.ts - Parameter handling with conditional logic\nimport { Server } from "oc-server";\n\nexport const server = new Server()\n  .withParameters({\n    name: { type: "string", default: "Guest" },\n    theme: { type: "string", default: "light" },\n  })\n  .handler(async (params) => {\n    const now = new Date();\n    return {\n      name: params.name ?? "Guest",\n      theme: params.theme ?? "light",\n      currentTime: now.toLocaleTimeString(),\n      cssClass: params.theme === "dark" ? "dark-theme" : "light-theme",\n    };\n  });\n'})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-tsx",children:"// src/entry.client.tsx\nexport default function Component(props: {\n  name: string;\n  theme: string;\n  currentTime: string;\n  cssClass: string;\n}) {\n  return (\n    <div className={props.cssClass}>\n      <h3>Hello {props.name}!</h3>\n      <p>Current time: {props.currentTime}</p>\n    </div>\n  );\n}\n"})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Usage"}),": ",(0,t.jsx)(n.code,{children:'<oc-component href="http://localhost:3030/greeting?name=Alice&theme=dark"></oc-component>'})]}),"\n",(0,t.jsx)(n.h2,{id:"real-world-example-user-dashboard",children:"Real-World Example: User Dashboard"}),"\n",(0,t.jsx)(n.p,{children:"Here's a more complex example that combines authentication, API data fetching, and error handling:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:'// src/entry.server.ts - User dashboard with auth and API integration\nimport { Server } from "oc-server";\n\ntype User = {\n  id: string;\n  name: string;\n  email: string;\n  role: "user" | "admin";\n} | null;\n\nasync function getUserFromToken(token?: string): Promise<User> {\n  if (!token) return null;\n  // In real implementation: validate JWT token\n  return {\n    id: "123",\n    name: "John Doe",\n    email: "john@example.com",\n    role: "user",\n  };\n}\n\nexport const server = new Server()\n  .withParameters({ userId: { type: "number", mandatory: true } })\n  .middleware(async (_params, ctx) => {\n    const token = ctx.requestHeaders.authorization?.replace("Bearer ", "");\n    const user = await getUserFromToken(token);\n    return { user };\n  })\n  .handler(async ({ userId }, ctx) => {\n    const isAuthenticated = !!ctx.state.user;\n\n    if (!isAuthenticated) {\n      return {\n        error: "Authentication required",\n        showLoginButton: true,\n      } as const;\n    }\n\n    try {\n      // In real implementation: fetch from API\n      // const res = await fetch(`https://api.example.com/users/${userId}`);\n      // const userData = await res.json();\n\n      const userData = {\n        name: "John Doe",\n        email: "john@example.com",\n        lastLogin: "2025-01-15",\n        profileComplete: true,\n      };\n\n      return {\n        user: userData,\n        isAuthenticated: true,\n        userRole: ctx.state.user?.role ?? "guest",\n        showLogoutButton: true,\n      };\n    } catch {\n      return {\n        error: "Failed to load user data",\n        isAuthenticated: true,\n      } as const;\n    }\n  });\n'})}),"\n",(0,t.jsx)(n.h2,{id:"advanced-features",children:"Advanced Features"}),"\n",(0,t.jsx)(n.h3,{id:"error-handling",children:"Error handling"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:'import { Server, ServerError } from "oc-server";\n\nfunction processData(param: string) {\n  return { processed: param };\n}\n\nexport const server = new Server()\n  .withParameters({ required: { type: "string", mandatory: true } })\n  .handler(async ({ required }) => {\n    if (!required) throw new ServerError(400, "Required parameter missing");\n    return processData(required);\n  });\n'})}),"\n",(0,t.jsx)(n.p,{children:"To prevent rendering entirely (e.g., invalid state), return nothing:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:'export const server = new Server().handler(async (params) => {\n  if ((params as any).name === "Invalid") {\n    return; // prevents rendering\n  }\n  return { name: (params as any).name };\n});\n'})}),"\n",(0,t.jsx)(n.h3,{id:"using-context",children:"Using context"}),"\n",(0,t.jsxs)(n.p,{children:["The context object (",(0,t.jsx)(n.code,{children:"ctx"}),") provides access to request data and helpers:"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["acceptLanguage: parsed ",(0,t.jsx)(n.code,{children:"Accept-Language"})," header"]}),"\n",(0,t.jsx)(n.li,{children:"baseUrl: registry base URL"}),"\n",(0,t.jsx)(n.li,{children:"env: registry environment"}),"\n",(0,t.jsx)(n.li,{children:"params: validated parameters"}),"\n",(0,t.jsx)(n.li,{children:"plugins: registry plugins"}),"\n",(0,t.jsx)(n.li,{children:"requestHeaders: original request headers"}),"\n",(0,t.jsx)(n.li,{children:"requestIp: client IP"}),"\n",(0,t.jsx)(n.li,{children:"setEmptyResponse(): set the response to empty"}),"\n",(0,t.jsx)(n.li,{children:"setHeader(name, value): set a response header"}),"\n",(0,t.jsx)(n.li,{children:"setCookie(name, value, options?): set a cookie"}),"\n",(0,t.jsx)(n.li,{children:"staticPath: public path for static assets"}),"\n",(0,t.jsx)(n.li,{children:"templates: template metadata"}),"\n",(0,t.jsx)(n.li,{children:"state: middleware-provided state"}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"context-properties",children:"Context properties"}),"\n",(0,t.jsx)(n.p,{children:"Context aggregates request data, and the registry's context. It consists of the following fields:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'{\n  "acceptLanguage": [\n    {\n      "code": "en",\n      "region": "US",\n      "quality": 1\n    },\n    {\n      "code": "en",\n      "quality": 0.8\n    }\n  ],\n  "baseUrl": "http://localhost:3030/",\n  "env": {\n    "name": "local"\n  },\n  "params": {\n    "name": "Johnny"\n  },\n  "renderComponent": [Function],\n  "renderComponents": [Function],\n  "requestHeaders": {\n      "host": "localhost:3000",\n      "connection": "keep-alive",\n      "accept": "application/vnd.oc.unrendered+json",\n      "user-agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_10_5) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/49.0.2623.87 Safari/537.36",\n      "content-type": "text/plain",\n      "referer": "http://localhost:3000/oc-client/0.28.5/~preview/",\n      "accept-encoding": "gzip, deflate, sdch",\n      "accept-language": "en-US,en;q=0.8",\n  },\n  "setEmptyResponse": [Function],\n  "setHeader": [Function],\n  "staticPath": "http://localhost:3030/hello-world/1.0.0/static/"\n}\n'})}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Parameter"}),(0,t.jsx)(n.th,{children:"Type"}),(0,t.jsx)(n.th,{children:"Description"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"acceptLanguage"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"array of objects"})}),(0,t.jsxs)(n.td,{children:["represents parsed ",(0,t.jsx)(n.code,{children:"accept-language"})," part of the request header sorted by quality. More details ",(0,t.jsx)(n.a,{href:"https://github.com/opentable/accept-language-parser",children:"here"})]})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"baseUrl"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"string"})}),(0,t.jsx)(n.td,{children:"represents public registry base url. This is required when we want to nest components that are hosted in the same registry for client-side rendering"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"env"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"object"})}),(0,t.jsxs)(n.td,{children:["represents the registry environment variables. The registry's admin ",(0,t.jsx)(n.a,{href:"/docs/registry/registry-configuration#registry-configuration",children:"can share here arbitrary data"})]})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"params"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"object"})}),(0,t.jsx)(n.td,{children:"represents parameters extracted from the query string"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"plugins"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"array of functions"})}),(0,t.jsxs)(n.td,{children:[(0,t.jsx)(n.a,{href:"/docs/registry/registry-configuration#plugins",children:"custom functionalities that extend the registry"}),". Note: if a component needs a plugin, ",(0,t.jsx)(n.a,{href:"/docs/components/getting-started#structure-of-the-package",children:"it needs to be declared in the component's package.json"})]})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"renderComponent"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"function"})}),(0,t.jsxs)(n.td,{children:["Needed to do server-side nested renderings. ",(0,t.jsx)(n.a,{href:"#rendercomponent-api",children:"renderComponent API"})]})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"renderComponents"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"function"})}),(0,t.jsxs)(n.td,{children:["Needed to do server-side nested renderings. ",(0,t.jsx)(n.a,{href:"#rendercomponents-api",children:"renderComponents API"})]})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"requestHeaders"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"object"})}),(0,t.jsx)(n.td,{children:"represents the original request headers. When component is rendered client side this will be what is sent from the browser, when rendered server side, using oc-client, this will contain whatever the client has been configured to forward"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"setEmptyResponse"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"function"})}),(0,t.jsxs)(n.td,{children:["Sets the response to be completely empty (included container and renderInfo). Recommended is to return it: ",(0,t.jsx)(n.code,{children:"return context.setEmptyResponse();"})]})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"setHeader"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"function"})}),(0,t.jsx)(n.td,{children:"Needed to set custom headers. Signature is (name, value)"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"setCookie"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"function"})}),(0,t.jsx)(n.td,{children:"Needed to set cookies. Signature is (name, value, options?) where options supports all standard Express cookie options (httpOnly, secure, maxAge, etc.)"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"staticPath"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"string"})}),(0,t.jsxs)(n.td,{children:["represents the path to static resources i.e. images, styles, javascript files. This is required to ",(0,t.jsx)(n.a,{href:"#add-static-resource-to-the-component",children:"reference static resources to the view"})," and ",(0,t.jsx)(n.strong,{children:"already includes a final slash"})," (this is relevant due to how S3 handles filePaths)."]})]})]})]}),"\n",(0,t.jsx)(n.h3,{id:"rendercomponent-api",children:"renderComponent API"}),"\n",(0,t.jsxs)(n.p,{children:["Signature: ",(0,t.jsx)(n.code,{children:"context.renderComponent(componentName [, options], callback)"})]}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Parameter"}),(0,t.jsx)(n.th,{children:"Type"}),(0,t.jsx)(n.th,{children:"Mandatory"}),(0,t.jsx)(n.th,{children:"Description"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"componentName"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"string"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"yes"})}),(0,t.jsx)(n.td,{children:"The component's name to be rendered. Needs to be hosted on the same registry"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"options"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"object"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"no"})}),(0,t.jsx)(n.td,{children:"The options"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"options.version"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"string"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"no"})}),(0,t.jsx)(n.td,{children:"Default '' (latest) - the version of the component to render"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"options.parameters"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"object"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"no"})}),(0,t.jsx)(n.td,{children:"Component's parameters"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"options.headers"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"object"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"no"})}),(0,t.jsx)(n.td,{children:"Headers to be injected to the nested component"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"callback"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"function"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"yes"})}),(0,t.jsx)(n.td,{children:"The callback. Signature is callback(error, html)"})]})]})]}),"\n",(0,t.jsx)(n.h3,{id:"rendercomponents-api",children:"renderComponents API"}),"\n",(0,t.jsxs)(n.p,{children:["Signature: ",(0,t.jsx)(n.code,{children:"context.renderComponents(components [, options], callback)"})]}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Parameter"}),(0,t.jsx)(n.th,{children:"Type"}),(0,t.jsx)(n.th,{children:"Mandatory"}),(0,t.jsx)(n.th,{children:"Description"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"components"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"array"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"yes"})}),(0,t.jsx)(n.td,{children:"The components to be rendered. Need to be hosted on the same registry"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"components[index].name"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"string"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"yes"})}),(0,t.jsx)(n.td,{children:"The component's name to be rendered"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"components[index].version"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"string"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"no"})}),(0,t.jsx)(n.td,{children:"Default '' (latest) - the version of the component to render"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"components[index].parameters"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"object"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"no"})}),(0,t.jsx)(n.td,{children:"The components' parameters"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"options"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"object"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"no"})}),(0,t.jsx)(n.td,{children:"The global options"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"options.parameters"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"object"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"no"})}),(0,t.jsx)(n.td,{children:'Components "global" parameters. If in need to render many components with the same parameters, they can be specified "globally" instead of in each component\'s "parameters" field'})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"options.headers"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"object"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"no"})}),(0,t.jsx)(n.td,{children:"Headers to be forwarded to be injected to the nested components"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"callback"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"function"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"yes"})}),(0,t.jsxs)(n.td,{children:["The callback. Signature is callback(error, response). Response will be an array with a mix of strings of html (in case of success) and/or ",(0,t.jsx)(n.code,{children:"Error"})," containing the details (in case of failure)"]})]})]})]}),"\n",(0,t.jsx)(n.h2,{id:"add-static-resource-to-the-component",children:"Add static resource to the component"}),"\n",(0,t.jsxs)(n.p,{children:["In this example an image (",(0,t.jsx)(n.code,{children:"public/static_resource.png"}),") will be our static resource."]}),"\n",(0,t.jsx)(n.h3,{id:"prepare-package-file",children:"Prepare package file"}),"\n",(0,t.jsxs)(n.p,{children:["Add ",(0,t.jsx)(n.code,{children:"static"})," to ",(0,t.jsx)(n.code,{children:"oc.files"})," and point to the modern entries:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'{\n  "name": "hello-world",\n  "version": "1.0.0",\n  "oc": {\n    "files": {\n      "data": "src/entry.server.ts",\n      "template": {\n        "src": "src/entry.client.tsx",\n        "type": "oc-template-esm"\n      },\n      "static": ["public"]\n    }\n  }\n}\n'})}),"\n",(0,t.jsxs)(n.p,{children:["It is an array of names of directories. In the above example the ",(0,t.jsx)(n.code,{children:"public"})," directory will be included inside the package."]}),"\n",(0,t.jsx)(n.h3,{id:"add-image-in-the-view-template",children:"Add image in the view template"}),"\n",(0,t.jsxs)(n.p,{children:["We can add image to the component view template using ",(0,t.jsx)(n.code,{children:"img"})," tag in which ",(0,t.jsx)(n.code,{children:"src"})," attribute is bound to ",(0,t.jsx)(n.code,{children:"img"})," viewModel property."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-tsx",children:"export default function Component(props: { path: string }) {\n  return <img src={`${props.path}public/static_resource.png`} />;\n}\n"})}),"\n",(0,t.jsx)(n.h3,{id:"update-server-file",children:"Update server file"}),"\n",(0,t.jsxs)(n.p,{children:["To provide ",(0,t.jsx)(n.code,{children:"img"})," parameter in our viewModel we need to update ",(0,t.jsx)(n.code,{children:"server.js"}),". The important thing is we need to use ",(0,t.jsx)(n.code,{children:"context.staticPath"})," to provide url to the static resources:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:'import { Server } from "oc-server";\n\nexport const server = new Server().handler(async (_params, ctx) => {\n  return { path: ctx.staticPath };\n});\n'})}),"\n",(0,t.jsx)(n.h2,{id:"performance-tips",children:"Performance Tips"}),"\n",(0,t.jsx)(n.p,{children:"Keep your server entry lightweight and efficient:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:'// \u2705 Good: Cache results, use timeouts, return only needed data\nexport const server = new Server()\n  .withParameters({ userId: { type: "number", mandatory: true } })\n  .handler(async ({ userId }) => {\n    // Use caching for expensive operations\n    const cached = getFromCache(`user-${userId}`);\n    if (cached) return cached;\n\n    // Set timeout for external requests\n    const ac = new AbortController();\n    const timer = setTimeout(() => ac.abort(), 5000);\n\n    try {\n      // const res = await fetch(`/api/users/${userId}`, { signal: ac.signal });\n      // const userData = await res.json();\n\n      // Return only what the view needs\n      const result = { name: "John", email: "john@example.com" };\n      setCache(`user-${userId}`, result, 300); // Cache for 5 minutes\n      return result;\n    } catch {\n      return { error: "Request timeout" } as const;\n    } finally {\n      clearTimeout(timer);\n    }\n  });\n'})}),"\n",(0,t.jsx)(n.h2,{id:"nodejs-dependencies",children:"Node.js dependencies"}),"\n",(0,t.jsx)(n.h3,{id:"local-development",children:"Local development"}),"\n",(0,t.jsxs)(n.p,{children:["List dependencies in your component's ",(0,t.jsx)(n.code,{children:"package.json"}),":"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'{\n  "name": "my-component",\n  "dependencies": {\n    "lodash": "^4.17.21",\n    "moment": "^2.29.4",\n    "axios": "^1.0.0"\n  }\n}\n'})}),"\n",(0,t.jsxs)(n.p,{children:["Then use them in ",(0,t.jsx)(n.code,{children:"src/entry.server.ts"})," (ESM imports):"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:'import _ from "lodash";\nimport dayjs from "dayjs";\nimport axios from "axios";\nimport { Server } from "oc-server";\n\nexport const server = new Server()\n  .withParameters({ users: { type: "string" } })\n  .handler(async (params) => {\n    const users = _.uniqBy(JSON.parse(params.users || "[]"), "id");\n    const currentDate = dayjs().format("YYYY-MM-DD");\n    return { users, currentDate };\n  });\n'})}),"\n",(0,t.jsx)(n.h3,{id:"publishing-considerations",children:"Publishing considerations"}),"\n",(0,t.jsx)(n.p,{children:"When publishing, the registry may restrict dependencies for security and performance:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Allowed"}),": Common utilities (lodash, moment, axios)"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Restricted"}),": File system access, network libraries, native modules"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Forbidden"}),": Packages with security vulnerabilities"]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"Check with your registry administrator about approved dependencies."}),"\n",(0,t.jsx)(n.h2,{id:"common-issues",children:"Common Issues"}),"\n",(0,t.jsx)(n.h3,{id:"missing-return-statement",children:"Missing return statement"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:'// \u274c Problem - not returning data\nexport const server = new Server().handler(async () => {\n  const data = { message: "Hello" };\n  // Forgot to return data\n});\n\n// \u2705 Solution - always return data\nexport const server2 = new Server().handler(async () => {\n  return { message: "Hello" };\n});\n'})}),"\n",(0,t.jsx)(n.h3,{id:"undefined-property-access",children:"Undefined property access"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:'// \u274c Problem - not checking optional fields\nexport const server = new Server().handler(async (params: any) => {\n  const name = params.user.name; // Error if user is undefined\n  return { name };\n});\n\n// \u2705 Solution - defensive programming\nexport const server2 = new Server().handler(async (params: any) => {\n  const user = params.user || {};\n  const name = user.name || "Anonymous";\n  return { name };\n});\n'})}),"\n",(0,t.jsx)(n.h3,{id:"debugging-tips",children:"Debugging tips"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Enable browser console relay"}),": ",(0,t.jsx)(n.code,{children:"new Server({ development: { console: true } })"})]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Use console.log"}),": Add logging to understand data flow"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Check browser network tab"}),": Verify component requests and responses"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Validate JSON"}),": Ensure your callback data is valid JSON"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Test parameters"}),": Use ",(0,t.jsx)(n.code,{children:"oc preview"})," to test different parameter combinations"]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"type-inference-optional",children:"Type inference (optional)"}),"\n",(0,t.jsxs)(n.p,{children:["For automatic type inference between server and client, add this to ",(0,t.jsx)(n.code,{children:"src/entry.server.ts"}),":"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:'declare module "oc-server" {\n  interface Register {\n    server: typeof server;\n  }\n}\n'})}),"\n",(0,t.jsx)(n.h2,{id:"legacy-deprecated-serverjs-with-callbacks",children:"Legacy (deprecated): server.js with callbacks"}),"\n",(0,t.jsxs)(n.p,{children:["This older style is still supported for existing components, but new code should use ",(0,t.jsx)(n.code,{children:"Server"})," as shown above."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-js",children:'// server.js (legacy)\nmodule.exports.data = function (context, callback) {\n  const name = context.params.name || "Guest";\n  callback(null, { name });\n};\n'})}),"\n",(0,t.jsx)(n.h2,{id:"next-steps",children:"Next Steps"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:(0,t.jsx)(n.a,{href:"package.json-structure",children:"Learn package.json structure"})})," - Configure your component properly"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:(0,t.jsx)(n.a,{href:"cli",children:"Master the CLI"})})," - Efficient development workflow"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:(0,t.jsx)(n.a,{href:"publishing-to-a-registry",children:"Publishing guide"})})," - Deploy your components"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:(0,t.jsx)(n.a,{href:"../consumers/rendering-lifecycle",children:"Client-side operations"})})," - Browser integration patterns"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(l,{...e})}):l(e)}},8453:(e,n,r)=>{r.d(n,{R:()=>d,x:()=>c});var s=r(6540);const t={},i=s.createContext(t);function d(e){const n=s.useContext(i);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:d(e.components),s.createElement(i.Provider,{value:n},e.children)}}}]);